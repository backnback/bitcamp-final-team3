<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <title>모두의 여행</title>
</head>
<body>
<header>
</header>

<h1>여행지역 선택</h1>


<select id="stateCode" name="stateCode" onchange="fetchCityList()">
    <option value="">시도 선택</option>
    <option data-th-each="state : ${stateList}"
            data-th-text="${state.stateName}"
            data-th-value="${state.stateCode}">시도명
    </option>
</select>

<select id="cityCode" name="cityCode">
    <option value="">시군구 선택</option>
</select>

<!-- 일정 생성 폼 -->
<form action="/schedule/selectLocation" id="createScheduleForm" method="post">
    <input name="tripType" type="hidden" value="/schedule/selectLocation"/>
    <input id="cityCodeHidden" name="cityCode" type="hidden">
    <div class="btn btn-mint">
        <button class="custom-btn custom-btn-white" type="submit">일정생성</button>
    </div>
</form>

<!-- 일정 가져오기 폼 -->
<form action="/schedule/makeTrip" id="fetchScheduleForm" method="post">
    <input name="tripType" type="hidden" value="/schedule/selectTripList"/>
    <input id="stateCodeHiddenFetch" name="stateCode" type="hidden">
    <input id="stateNameHiddenFetch" name="stateName" type="hidden">
    <input id="cityCodeHiddenFetch" name="cityCode" type="hidden">
    <input id="cityNameHiddenFetch" name="cityName" type="hidden">
    <div class="btn btn-black">
        <button class="custom-btn custom-btn-white" type="submit">일정가져오기</button>
    </div>
</form>

<script>
    // 변환된 JSON 데이터 사용 예시
    const stateSelect = document.getElementById('stateCode');

    function fetchCityList() {
        const selectedState = document.getElementById('stateCode');
        const stateCode = selectedState.value;

        if (stateCode) {
            fetch('/schedule/selectCity', {
                method: 'POST',
                headers: {
                    'Content-Type': 'text/plain',  // JSON 대신 text로 변경
                },
                body: stateCode  // stateCode만 직접 전송
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(cityList => {
                    const citySelect = document.getElementById('cityCode');
                    citySelect.innerHTML = '<option value="">시군구 선택</option>';

                    cityList.forEach(city => {
                        const option = document.createElement('option');
                        option.value = city.cityCode;
                        option.textContent = city.cityName;
                        citySelect.appendChild(option);
                    });
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('시군구 목록을 불러오는데 실패했습니다.');
                });
        } else {
            const citySelect = document.getElementById('cityCode');
            citySelect.innerHTML = '<option value="">시군구 선택</option>';
        }
    }

    // form submit 이벤트 핸들러 추가
    document.getElementById('createScheduleForm').addEventListener('submit', function (event) {
        const selectedCity = document.getElementById('cityCode').value;
        if (!selectedCity) {
            event.preventDefault(); // 폼 제출 중단
            alert('시군구를 선택해주세요.');
            return;
        }
        document.getElementById('cityCodeHidden').value = selectedCity;
    });

    document.getElementById('fetchScheduleForm').addEventListener('submit', function (event) {
        const selectedCity = document.getElementById('cityCode').value;
        if (!selectedCity) {
            event.preventDefault(); // 폼 제출 중단
            alert('시군구를 선택해주세요.');
            return;
        }
        document.getElementById('cityCodeHiddenFetch').value = selectedCity;
    });


    // document.getElementById('createScheduleForm').addEventListener('submit', function (event) {
    //     document.getElementById('stateCodeHidden').value = document.getElementById('stateCode').value;
    //     document.getElementById('cityCodeHidden').value = document.getElementById('cityCode').value;
    // });
    //
    // document.getElementById('fetchScheduleForm').addEventListener('submit', function (event) {
    //     document.getElementById('stateCodeHiddenFetch').value = document.getElementById('stateCode').value;
    //     document.getElementById('cityCodeHiddenFetch').value = document.getElementById('cityCode').value;
    // });
    //
    // // 시도 선택 시 시군구 리스트를 불러오는 함수 (POST 요청)
    // function fetchCityList() {
    //     // 선택된 옵션 요소 가져오기
    //     const selectedOption = document.getElementById('stateCode').selectedOptions[0];
    //
    //     // 선택된 옵션에서 data-state 속성 값 가져오기
    //     const stateData = selectedOption.getAttribute('data-state');
    //
    //     if (stateData) {
    //         const state = JSON.parse(stateData);
    //
    //         fetch('/schedule/selectCity', {
    //             method: 'POST',
    //             headers: {
    //                 'Content-Type': 'application/json'  // JSON 형식으로 전송
    //             },
    //             body: JSON.stringify(state)  // State 객체를 JSON 문자열로 변환하여 전송
    //         })
    //             .then(response => response.json())
    //             .then(data => {
    //                 const citySelect = document.getElementById('cityCode');
    //                 citySelect.innerHTML = ''; // 기존 옵션 초기화
    //
    //                 data.forEach(city => {
    //                     const option = document.createElement('option');
    //                     option.value = city.cityCode;
    //                     option.textContent = city.cityName;
    //                     citySelect.appendChild(option); // 새로운 옵션 추가
    //                 });
    //             })
    //             .catch(error => console.error('Error fetching city list:', error));
    //     }
    // }
</script>

</body>
</html>
<!--stateList.forEach(state => {-->
<!--const option = document.createElement('option');-->
<!--option.value = state.code;-->
<!--option.textContent = state.name;-->
<!--stateSelect.appendChild(option);-->
<!--});-->

<!--document.getElementById('createScheduleForm').addEventListener('submit', function (event) {-->
<!--const selectedState = document.getElementById('stateCode').selectedOptions[0];-->
<!--const selectedCity = document.getElementById('cityCode').selectedOptions[0];-->
<!--document.getElementById('stateCodeHidden').value = selectedState.value;-->
<!--document.getElementById('stateNameHidden').value = selectedState.textContent; // stateName 설정-->
<!--document.getElementById('cityCodeHidden').value = selectedCity.value;-->
<!--document.getElementById('cityNameHidden').value = selectedCity.textContent;-->


<!--});-->

<!--document.getElementById('fetchScheduleForm').addEventListener('submit', function (event) {-->
<!--const selectedState = document.getElementById('stateCode').selectedOptions[0];-->
<!--const selectedCity = document.getElementById('cityCode').selectedOptions[0];-->
<!--document.getElementById('stateCodeHiddenFetch').value = selectedState.value;-->
<!--document.getElementById('stateNameHiddenFetch').value = selectedState.textContent; // stateName 설정-->
<!--document.getElementById('cityCodeHiddenFetch').value = selectedCity.value;-->
<!--document.getElementById('cityNameHiddenFetch').value = selectedCity.textContent;-->
<!--});-->
